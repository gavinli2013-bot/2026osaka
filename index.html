import React, { useState, useEffect, useMemo } from 'react';
import { 
  Calendar, MapPin, Sun, Languages, Navigation, 
  Camera, Utensils, ShoppingBag, Hotel, Car, 
  Thermometer, Wind, CloudSnow, Heart, 
  Wallet, RefreshCw, Volume2, 
  ChevronRight, Plus, X, Music, CheckCircle
} from 'lucide-react';

// --- å®®å´é§¿é¢¨æ ¼ SVG å…ƒä»¶ ---

const TotoroIcon = () => (
  <svg viewBox="0 0 100 100" className="w-20 h-20 opacity-90 drop-shadow-lg">
    <path d="M50 20 C30 20 15 40 15 65 C15 85 30 95 50 95 C70 95 85 85 85 65 C85 40 70 20 50 20" fill="#A5C9CA" />
    <path d="M50 25 C35 25 25 40 25 65 C25 80 35 90 50 90 C65 90 75 80 75 65 C75 40 65 25 50 25" fill="white" />
    <circle cx="40" cy="45" r="3" fill="#395B64" />
    <circle cx="60" cy="45" r="3" fill="#395B64" />
    <ellipse cx="50" cy="38" rx="4" ry="2" fill="#395B64" />
    <path d="M42 55 Q50 60 58 55" stroke="#395B64" strokeWidth="2" fill="none" />
    <path d="M35 70 L45 75 M55 75 L65 70" stroke="#A5C9CA" strokeWidth="2" strokeLinecap="round" />
    {/* è€³æœµ */}
    <path d="M30 25 L25 5 Z" fill="#A5C9CA" />
    <path d="M70 25 L75 5 Z" fill="#A5C9CA" />
  </svg>
);

const SootSprite = ({ className }) => (
  <svg viewBox="0 0 100 100" className={className}>
    <circle cx="50" cy="50" r="40" fill="#2D2D2D" />
    {/* æ¯›åˆºæ•ˆæœç”± filter æˆ–å¤šå€‹å°åœ“æ¨¡æ“¬ï¼Œé€™è£¡ç°¡åŒ– */}
    <circle cx="35" cy="45" r="10" fill="white" />
    <circle cx="65" cy="45" r="10" fill="white" />
    <circle cx="35" cy="45" r="3" fill="black" />
    <circle cx="65" cy="45" r="3" fill="black" />
  </svg>
);

// --- ä¸»ç¨‹å¼ ---

const App = () => {
  const [activeTab, setActiveTab] = useState('itinerary');
  const [activeDay, setActiveDay] = useState(0);
  
  // è¨˜å¸³ç‹€æ…‹
  const [exchangeRate, setExchangeRate] = useState(0.052);
  const [expenses, setExpenses] = useState([]);
  const [expenseInput, setExpenseInput] = useState({ amount: '', category: 'åƒ', note: '' });
  const [isRefreshing, setIsRefreshing] = useState(false);

  // å®Œæ•´è¡Œç¨‹è³‡æ–™ (Day 1 - Day 5)
  const itineraryData = [
    {
      day: 1,
      date: '2/20 (äº”)',
      location: 'å¤§é˜ªå¸‚ä¸­å¿ƒ',
      hotel: 'Hotel Mystays Otemae',
      weather: { temp: '4Â°C', range: '4-11Â°C', desc: 'æ™´æ™‚å¤šé›²', snow: '5%', wear: 'ç™¼ç†±è¡£ + ç¾Šæ¯›è¡« + é˜²é¢¨åšå¤–å¥—' },
      events: [
        { time: '04:10', type: 'transport', title: 'é¦™æ¸¯é£›å¤§é˜ª (HKG â†’ KIX)', desc: 'CXèˆªç­é è¨ˆ 08:35 åˆ°é”ã€‚', tags: ['20kgè¡Œæ'], lat: 34.432, lng: 135.230 },
        { time: '10:30', type: 'transport', title: 'æ©Ÿå ´ç§»å‹•', desc: 'å—æµ·é›»éµ Rapit åˆ°é›£æ³¢/å¸‚å€ã€‚', tags: ['å¿…æ­'], lat: 34.661, lng: 135.500 },
        { time: '12:00', type: 'food', title: 'é»‘é–€å¸‚å ´', desc: 'æ—©é¤/åˆé¤ï¼šæ–°é®®æµ·é®®ã€çƒ¤æ‰‡è²ã€‚', tags: ['å¿…åƒ'], lat: 34.665, lng: 135.505 },
        { time: '15:00', type: 'hotel', title: 'Check-in', desc: 'Hotel Mystays Otemae æ”¾è¡Œæã€‚', tags: ['ä½å®¿'], lat: 34.685, lng: 135.518 },
        { time: '18:30', type: 'food', title: 'æµœç‡’é…’å ´ ç£¯ä¹‹é¦™', desc: 'æ™šé¤ï¼šæµ·é®®ç£¯ç‡’ç››åˆã€‚', tags: ['å¿…åƒ'], lat: 34.669, lng: 135.501 },
        { time: '21:00', type: 'activity', title: 'å¸‚å€æº«æ³‰', desc: 'é£¯å¾Œæ”¾é¬†ï¼Œæ¶ˆé™¤é£›è¡Œç–²å‹ã€‚', tags: ['æ”¾é¬†'], lat: 34.650, lng: 135.500 }
      ]
    },
    {
      day: 2,
      date: '2/21 (å…­)',
      location: 'å¤§é˜ªç£å€ / EXPO',
      hotel: 'Hotel Mystays Otemae',
      weather: { temp: '3Â°C', range: '3-9Â°C', desc: 'å¯’å†·', snow: '10%', wear: 'ç¾½çµ¨è¡£ + æ‰‹å¥— + æ¯›å¸½' },
      events: [
        { time: '08:00', type: 'activity', title: 'æ™¨è·‘ 5km', desc: 'è¼•é¬†è·‘ 30minï¼Œé©æ‡‰æ°£æº«ã€‚', tags: ['é‹å‹•'], lat: 34.685, lng: 135.525 },
        { time: '11:00', type: 'food', title: 'Diorama Restaurant', desc: 'Brunchï¼šéµé“æ¨¡å‹èˆ‡æ•‘æ´è²“é¤å»³ã€‚', tags: ['å¿…ç©: è²“å’ª'], lat: 34.647, lng: 135.523 },
        { time: '14:00', type: 'activity', title: 'INTEX å¤§é˜ª EXPO', desc: 'é ˜å–è™Ÿç¢¼å¸ƒ + åƒè§€åšè¦½æœƒã€‚', tags: ['é‡é»'], lat: 34.636, lng: 135.420 },
        { time: '19:00', type: 'food', title: 'Carbo-loading', desc: 'ç¾ç¾å¯çƒé¾éºµæˆ–é«˜ç´šç¾©å¤§åˆ©éºµã€‚', tags: ['å‚™è³½'], lat: 34.680, lng: 135.500 }
      ]
    },
    {
      day: 3,
      date: '2/22 (æ—¥)',
      location: 'å¤§é˜ªé¦¬æ‹‰æ¾',
      hotel: 'Hotel Mystays Otemae',
      weather: { temp: '2Â°C', range: '2-10Â°C', desc: 'æ™´æœ—', snow: '0%', wear: 'è·‘è¡£ + æ‹‹æ£„å¼é›¨è¡£ (èµ·é»ä¿æš–)' },
      events: [
        { time: '09:15', type: 'activity', title: 'å¤§é˜ªé¦¬æ‹‰æ¾ START!', desc: 'å¤§é˜ªåŸå…¬åœ’èµ·è·‘ â†’ 42.195kmã€‚', tags: ['æŒ‘æˆ°'], lat: 34.686, lng: 135.520 },
        { time: '16:00', type: 'activity', title: 'Spa World ä¸–ç•Œå¤§æº«æ³‰', desc: 'å®Œè³½å¾Œè‚Œè‚‰æ”¾é¬†ï¼Œäº«å—å¤šåœ‹æµ´æ± ã€‚', tags: ['å¿…æ³¡'], lat: 34.650, lng: 135.505 },
        { time: '19:00', type: 'food', title: 'æ…¶åŠŸå®´', desc: 'å¿ƒé½‹æ©‹ï¼šæ¶®æ¶®é‹ã€å£½å–œç‡’ã€èƒèŸ¹ã€‚', tags: ['å¿…åƒ'], lat: 34.670, lng: 135.500 }
      ]
    },
    {
      day: 4,
      date: '2/23 (ä¸€)',
      location: 'å’Œæ­Œå±±è‡ªé§•',
      hotel: 'å˜‰å¤ªæº«æ³‰å¤ªæµ·æœˆé…’åº—',
      weather: { temp: '5Â°C', range: '5-12Â°C', desc: 'æµ·é‚Šå¤šé›²', snow: '0%', wear: 'å±¤æ¬¡ç©¿æ­ + é˜²é¢¨' },
      events: [
        { time: '09:00', type: 'food', title: 'Cafe Tokiona', desc: 'å¾©å¤é¢¨æ—©é¤ï¼Œåšåˆ‡åå¸ã€‚', tags: ['æ‰“å¡'], lat: 34.688, lng: 135.515 },
        { time: '11:00', type: 'transport', title: 'å¤§é˜ªç§Ÿè»Š', desc: 'å–è»Šå‰å¾€å’Œæ­Œå±± (æª¢æŸ¥ETCå¡)ã€‚', tags: ['è‡ªé§•'], lat: 34.700, lng: 135.500 },
        { time: '12:30', type: 'food', title: 'é»‘æ½®å¸‚å ´', desc: 'çœ‹é®ªé­šè§£é«”ç§€ï¼Œåƒæµ·é®®ä¸¼ã€‚', tags: ['å¿…çœ‹'], lat: 34.153, lng: 135.181 },
        { time: '14:30', type: 'activity', title: 'è²´å¿—ç«™ (è²“ç«™é•·)', desc: 'æ¢è¨ªäºŒä»£ç‰/å››ä»£ç‰ç«™é•·ã€‚', tags: ['å¿…æ‹'], lat: 34.208, lng: 135.302 },
        { time: '16:00', type: 'activity', title: 'å’Œæ­Œå±±åŸ', desc: 'ç™»å¤©å®ˆé–£ï¼Œä¿¯ç°å¸‚æ™¯ã€‚', tags: ['è§€å…‰'], lat: 34.226, lng: 135.174 },
        { time: '18:00', type: 'hotel', title: 'Check-in æº«æ³‰æ—…é¤¨', desc: 'å—ç´€ç™½æ¿±/å˜‰å¤ªæº«æ³‰å¤ªæµ·æœˆã€‚', tags: ['ä½å®¿'], lat: 34.180, lng: 135.150 }
      ]
    },
    {
      day: 5,
      date: '2/24 (äºŒ)',
      location: 'å’Œæ­Œå±± â†’ é¦™æ¸¯',
      hotel: 'æº«æš–çš„å®¶',
      weather: { temp: '6Â°C', range: '6-13Â°C', desc: 'æ™´', snow: '0%', wear: 'èˆ’é©ä¼‘é–’ + æ©Ÿå ´ç©¿æ­' },
      events: [
        { time: '09:00', type: 'activity', title: 'å´ä¹‹æ¹¯', desc: 'æ—¥æœ¬å¤è€æµ·é‚Šéœ²å¤©æº«æ³‰ã€‚', tags: ['çµ•æ™¯'], lat: 33.680, lng: 135.334 },
        { time: '11:30', type: 'shopping', title: 'Rinku Outlet', desc: 'è‡¨ç©ºåŸ Outlets æœ€å¾Œè¡åˆºã€‚', tags: ['å¿…è²·'], lat: 34.406, lng: 135.295 },
        { time: '17:00', type: 'transport', title: 'é‚„è»Š & æ©Ÿå ´', desc: 'åŠ æ²¹ä¸¦é‚„è»Šï¼Œå‰å¾€ KIX T1ã€‚', tags: ['äº¤é€š'], lat: 34.432, lng: 135.230 },
        { time: '21:05', type: 'transport', title: 'å›ç¨‹ (KIX â†’ HKG)', desc: 'é è¨ˆ 00:45 æŠµé”é¦™æ¸¯ã€‚', tags: ['å›å®¶'], lat: 34.432, lng: 135.230 }
      ]
    }
  ];

  // ç¿»è­¯è³‡æ–™ (è£œé½Š)
  const translations = [
    { jp: "ã™ã¿ã¾ã›ã‚“ã€ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ", zh: "ä¸å¥½æ„æ€ï¼Œè«‹å•æ´—æ‰‹é–“åœ¨å“ªï¼Ÿ", kana: "Sumimasen, toire wa doko desu ka?" },
    { jp: "ãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚", zh: "éº»ç…©è²·å–®ã€‚", kana: "Okaikei o onegaishimasu." },
    { jp: "ã“ã‚Œã¯ã„ãã‚‰ã§ã™ã‹ï¼Ÿ", zh: "è«‹å•é€™å€‹å¤šå°‘éŒ¢ï¼Ÿ", kana: "Kore wa ikura desu ka?" },
    { jp: "è¢‹ã¯ã„ã‚Šã¾ã›ã‚“ã€‚", zh: "æˆ‘ä¸éœ€è¦å¡‘è† è¢‹ã€‚", kana: "Fukuro wa irimasen." },
    { jp: "è±šè‚‰ã¯å…¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ", zh: "è«‹å•é€™è£¡é¢æœ‰è±¬è‚‰å—ï¼Ÿ", kana: "Butaniku wa haitte imasu ka?" },
    { jp: "æº€ã‚¿ãƒ³ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚", zh: "è«‹æŠŠæ²¹åŠ æ»¿ (ç§Ÿè»Šé‚„è»Šç”¨)ã€‚", kana: "Mantan de onegaishimasu." },
    { jp: "å®Œèµ°ã—ã¾ã—ãŸï¼", zh: "æˆ‘è·‘å®Œé¦¬æ‹‰æ¾äº†ï¼", kana: "Kansou shimashita!" }
  ];

  // æ¨¡æ“¬ç²å–åŒ¯ç‡
  const fetchRate = () => {
    setIsRefreshing(true);
    setTimeout(() => {
      setExchangeRate(0.0515 + Math.random() * 0.001); // æ¨¡æ“¬æ³¢å‹•
      setIsRefreshing(false);
    }, 1500);
  };

  // è¨˜å¸³é‚è¼¯
  const handleAddExpense = () => {
    if (!expenseInput.amount) return;
    setExpenses([...expenses, { ...expenseInput, id: Date.now() }]);
    setExpenseInput({ ...expenseInput, amount: '', note: '' });
  };

  const categorySummary = useMemo(() => {
    const summary = { 'åƒ': 0, 'è²·': 0, 'äº¤é€š': 0, 'ä½å®¿': 0, 'å…¶ä»–': 0 };
    let total = 0;
    expenses.forEach(e => {
      const val = parseFloat(e.amount);
      if (summary[e.category] !== undefined) {
        summary[e.category] += val;
        total += val;
      }
    });
    return { summary, total };
  }, [expenses]);

  const speak = (text) => {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = 'ja-JP';
    window.speechSynthesis.speak(u);
  };

  return (
    <div className="min-h-screen bg-[#F0F4F8] pb-28 font-['Zen_Maru_Gothic',sans-serif] text-slate-700">
      
      {/* Header */}
      <header className="sticky top-0 z-20 bg-[#395B64] pt-8 pb-6 px-6 rounded-b-[40px] shadow-xl overflow-hidden">
        <div className="absolute top-2 right-4 animate-bounce duration-[3000ms]">
          <TotoroIcon />
        </div>
        <div className="absolute top-10 right-20 opacity-50">
          <SootSprite className="w-8 h-8 animate-spin duration-[10000ms]" />
        </div>
        
        <div className="relative z-10 text-white">
          <div className="flex items-center space-x-2 mb-1">
             <span className="bg-[#FFC0CB] text-[#395B64] text-[10px] font-black px-2 py-0.5 rounded-full">2026</span>
             <span className="text-xs opacity-80 tracking-widest">OSAKA MARATHON</span>
          </div>
          <h1 className="text-3xl font-black tracking-tight leading-none mb-1">å¤§é˜ªãƒ»å’Œæ­Œå±±</h1>
          <p className="text-sm opacity-90 font-medium flex items-center">
            <Calendar className="w-3 h-3 mr-1" />
            2æœˆ20æ—¥ - 2æœˆ24æ—¥
          </p>
        </div>
      </header>

      {/* Main Content Area */}
      <main className="px-4 py-6">

        {/* --- è¡Œç¨‹ Tab --- */}
        {activeTab === 'itinerary' && (
          <div className="space-y-6">
            {/* Day Selector */}
            <div className="flex space-x-3 overflow-x-auto pb-4 scrollbar-hide px-1">
              {itineraryData.map((day, idx) => (
                <button
                  key={idx}
                  onClick={() => setActiveDay(idx)}
                  className={`flex-shrink-0 flex flex-col items-center justify-center w-16 h-20 rounded-[24px] transition-all duration-300 ${
                    activeDay === idx 
                    ? 'bg-[#395B64] text-white shadow-lg scale-105' 
                    : 'bg-white text-slate-400 hover:bg-[#E7F6F2]'
                  }`}
                >
                  <span className="text-[10px] font-bold uppercase opacity-80">Day</span>
                  <span className="text-2xl font-black">{day.day}</span>
                  <span className="text-[10px]">{day.date.split(' ')[0]}</span>
                </button>
              ))}
            </div>

            {/* Weather Widget */}
            <div className="bg-gradient-to-r from-[#A5C9CA] to-[#E7F6F2] p-4 rounded-[28px] flex items-center space-x-4 shadow-sm border border-white">
              <div className="bg-white p-3 rounded-full shadow-md">
                <Sun className="text-orange-400 w-6 h-6" />
              </div>
              <div className="flex-1">
                <div className="flex justify-between items-end">
                  <h3 className="font-bold text-[#395B64]">{itineraryData[activeDay].location}</h3>
                  <span className="text-2xl font-black text-[#395B64]">{itineraryData[activeDay].weather.temp}</span>
                </div>
                <p className="text-xs text-slate-600 mt-1 line-clamp-1">
                  ğŸ’¡ {itineraryData[activeDay].weather.wear}
                </p>
              </div>
            </div>

            {/* Timeline Events */}
            <div className="space-y-4 relative pl-4">
               {/* Vertical Line */}
               <div className="absolute left-[27px] top-4 bottom-4 w-0.5 bg-[#A5C9CA]/50 border-l-2 border-dashed border-[#A5C9CA]"></div>

              {itineraryData[activeDay].events.map((event, idx) => (
                <div key={idx} className="relative pl-8">
                  {/* Timeline Dot */}
                  <div className="absolute left-0 top-4 w-6 h-6 bg-white border-4 border-[#FFC0CB] rounded-full z-10 shadow-sm"></div>
                  
                  {/* Card */}
                  <div className="bg-white rounded-[24px] p-5 shadow-sm border border-slate-100 group hover:shadow-md transition-all">
                    <div className="flex justify-between items-start mb-2">
                      <span className="text-xs font-black text-[#A5C9CA] bg-[#F0F4F8] px-2 py-1 rounded-lg">
                        {event.time}
                      </span>
                      <div className="flex gap-1">
                         {event.tags.map(t => (
                           <span key={t} className="text-[10px] px-2 py-1 bg-[#FFC0CB]/20 text-[#D87093] rounded-full font-bold">
                             {t}
                           </span>
                         ))}
                      </div>
                    </div>
                    
                    <h4 className="font-bold text-lg text-[#395B64] mb-1">{event.title}</h4>
                    <p className="text-xs text-slate-500 mb-3 leading-relaxed">{event.desc}</p>
                    
                    <div className="flex space-x-2">
                        <button 
                            onClick={() => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(event.title + " " + event.desc)}`, '_blank')}
                            className="flex-1 flex items-center justify-center space-x-1 bg-[#F0F4F8] hover:bg-[#A5C9CA] hover:text-white py-2 rounded-xl transition-colors text-xs font-bold text-slate-500"
                        >
                            <Navigation size={14} />
                            <span>å°èˆª</span>
                        </button>
                        <button className="flex-1 flex items-center justify-center space-x-1 bg-[#F0F4F8] hover:bg-[#FFC0CB] hover:text-[#395B64] py-2 rounded-xl transition-colors text-xs font-bold text-slate-500">
                            <Camera size={14} />
                            <span>ç´€éŒ„</span>
                        </button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
            
            {/* End of Day Totoro */}
            <div className="flex justify-center opacity-40 mt-8">
                <SootSprite className="w-12 h-12" />
            </div>
          </div>
        )}

        {/* --- è¨˜å¸³ Tab --- */}
        {activeTab === 'budget' && (
          <div className="space-y-6">
            <div className="bg-[#395B64] text-white p-6 rounded-[32px] shadow-lg relative overflow-hidden">
                <div className="relative z-10 flex justify-between items-center">
                    <div>
                        <p className="text-xs opacity-70 mb-1">å³æ™‚åŒ¯ç‡ (HKD/JPY)</p>
                        <h2 className="text-3xl font-black">{exchangeRate.toFixed(4)}</h2>
                        <p className="text-[10px] opacity-70 mt-1">æœ€å¾Œæ›´æ–°: å‰›å‰›</p>
                    </div>
                    <button onClick={fetchRate} className={`bg-white/20 p-3 rounded-full hover:bg-white/30 transition-all ${isRefreshing ? 'animate-spin' : ''}`}>
                        <RefreshCw size={20} />
                    </button>
                </div>
            </div>

            <div className="bg-white p-6 rounded-[32px] shadow-sm">
                <h3 className="font-bold text-[#395B64] mb-4">æ–°å¢æ”¯å‡º</h3>
                <div className="flex space-x-2 mb-3">
                    <input 
                        type="number" 
                        value={expenseInput.amount}
                        onChange={(e) => setExpenseInput({...expenseInput, amount: e.target.value})}
                        placeholder="Â¥ é‡‘é¡" 
                        className="flex-1 bg-[#F0F4F8] p-3 rounded-xl text-lg font-bold outline-none focus:ring-2 focus:ring-[#A5C9CA]"
                    />
                    <select 
                        value={expenseInput.category}
                        onChange={(e) => setExpenseInput({...expenseInput, category: e.target.value})}
                        className="bg-[#F0F4F8] p-3 rounded-xl font-bold text-slate-600 outline-none"
                    >
                        {['åƒ', 'è²·', 'äº¤é€š', 'ä½å®¿', 'å…¶ä»–'].map(c => <option key={c} value={c}>{c}</option>)}
                    </select>
                </div>
                <button onClick={handleAddExpense} className="w-full bg-[#395B64] text-white font-bold py-3 rounded-xl shadow-md hover:bg-[#2C4850] active:scale-95 transition-all flex justify-center items-center">
                    <Plus size={18} className="mr-2" /> è¨˜ä¸€ç­†
                </button>
            </div>

            {/* çµ±è¨ˆåœ–è¡¨å€ */}
            {categorySummary.total > 0 && (
                <div className="bg-white p-6 rounded-[32px] shadow-sm">
                    <div className="flex justify-between items-end mb-4">
                         <h3 className="font-bold text-[#395B64]">ç¸½æ”¯å‡ºçµ±è¨ˆ</h3>
                         <span className="text-xl font-black text-[#FFC0CB]">
                            HK$ {(categorySummary.total * exchangeRate).toFixed(0)}
                         </span>
                    </div>
                    
                    {/* CSS ç°¡æ˜“é•·æ¢åœ– */}
                    <div className="space-y-3">
                        {Object.entries(categorySummary.summary).map(([cat, val]) => {
                            const percent = (val / categorySummary.total) * 100;
                            if (val === 0) return null;
                            return (
                                <div key={cat}>
                                    <div className="flex justify-between text-xs mb-1 font-bold text-slate-500">
                                        <span>{cat}</span>
                                        <span>Â¥{val.toLocaleString()} ({percent.toFixed(0)}%)</span>
                                    </div>
                                    <div className="w-full bg-[#F0F4F8] h-3 rounded-full overflow-hidden">
                                        <div 
                                            className="h-full rounded-full transition-all duration-1000"
                                            style={{ 
                                                width: `${percent}%`, 
                                                backgroundColor: cat === 'åƒ' ? '#FFB7B2' : cat === 'è²·' ? '#FFDAC1' : cat === 'äº¤é€š' ? '#A5C9CA' : '#E2F0CB' 
                                            }}
                                        ></div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            )}
          </div>
        )}

        {/* --- åœ°åœ– Tab --- */}
        {activeTab === 'map' && (
          <div className="space-y-6">
            <div className="bg-[#A5C9CA] p-1 rounded-[32px] shadow-inner">
                <div className="bg-[#F0F4F8] rounded-[28px] h-48 flex flex-col items-center justify-center text-center p-6 border-4 border-white border-dashed">
                    <MapPin size={48} className="text-[#395B64] mb-2" />
                    <p className="font-bold text-[#395B64]">Day {activeDay + 1} æ™¯é»åœ°åœ–</p>
                    <p className="text-xs text-slate-500 mt-1">é»æ“Šä¸‹æ–¹åˆ—è¡¨é–‹å•Ÿå°èˆª</p>
                </div>
            </div>

            <div className="space-y-2">
                {itineraryData[activeDay].events.map((event, idx) => (
                    <button 
                        key={idx}
                        onClick={() => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(event.title)}`, '_blank')}
                        className="w-full bg-white p-4 rounded-2xl flex items-center justify-between shadow-sm hover:bg-[#E7F6F2] transition-colors"
                    >
                        <div className="flex items-center space-x-3">
                            <div className="bg-[#F0F4F8] p-2 rounded-full">
                                <Navigation size={16} className="text-[#395B64]" />
                            </div>
                            <div className="text-left">
                                <p className="font-bold text-sm text-slate-700">{event.title}</p>
                                <p className="text-[10px] text-slate-400">{event.location || event.type}</p>
                            </div>
                        </div>
                        <ChevronRight size={16} className="text-slate-300" />
                    </button>
                ))}
            </div>
          </div>
        )}

        {/* --- ç¿»è­¯ Tab --- */}
        {activeTab === 'translate' && (
          <div className="space-y-4">
             <div className="bg-white p-6 rounded-[32px] shadow-sm flex flex-col items-center text-center">
                <button 
                    onClick={() => window.open('https://lens.google/', '_blank')}
                    className="bg-[#FFC0CB] text-[#395B64] w-16 h-16 rounded-full flex items-center justify-center shadow-lg mb-3 hover:scale-110 transition-transform"
                >
                    <Camera size={32} />
                </button>
                <h3 className="font-bold text-[#395B64]">æ‹ç…§ç¿»è­¯ (Google Lens)</h3>
                <p className="text-xs text-slate-400 mt-1">æ‹æ”èœå–®æˆ–è·¯ç‰Œ</p>
             </div>

             <div className="space-y-3">
                {translations.map((t, idx) => (
                    <div key={idx} className="bg-white p-5 rounded-[24px] shadow-sm">
                        <div className="flex justify-between items-start mb-2">
                            <span className="text-xs font-bold text-[#A5C9CA] bg-[#F0F4F8] px-2 py-1 rounded-md">ä¸­æ–‡</span>
                            <button onClick={() => speak(t.jp)} className="text-[#395B64] p-2 hover:bg-[#E7F6F2] rounded-full">
                                <Volume2 size={20} />
                            </button>
                        </div>
                        <p className="font-bold text-slate-700 mb-2">{t.zh}</p>
                        <div className="border-t border-dashed border-slate-200 pt-2">
                             <p className="text-lg font-black text-[#395B64]">{t.jp}</p>
                             <p className="text-xs text-slate-400 italic mt-1">{t.kana}</p>
                        </div>
                    </div>
                ))}
             </div>
             
             <div className="h-4"></div>
             <button onClick={() => window.open('https://translate.google.com/', '_blank')} className="w-full py-4 bg-[#E7F6F2] text-[#395B64] font-bold rounded-2xl">
                æ‰“é–‹ Google ç¿»è­¯
             </button>
          </div>
        )}

        {/* --- å¤©æ°£é é¢ (ç¨ç«‹) --- */}
        {activeTab === 'weather' && (
             <div className="space-y-6">
                 {/* Current Day Big Card */}
                 <div className="bg-gradient-to-br from-[#395B64] to-[#2C4850] p-8 rounded-[40px] text-white text-center relative shadow-xl">
                     <div className="absolute top-4 left-4 opacity-20"><Wind size={40}/></div>
                     <p className="text-sm font-bold opacity-80 uppercase mb-2">OSAKA TODAY</p>
                     <div className="flex justify-center items-center space-x-2 my-2">
                         <h2 className="text-7xl font-black">{itineraryData[activeDay].weather.temp}</h2>
                     </div>
                     <p className="font-medium text-lg mb-6">{itineraryData[activeDay].weather.desc}</p>
                     
                     <div className="bg-white/10 backdrop-blur-md rounded-2xl p-4 flex justify-around">
                        <div className="text-center">
                            <CloudSnow size={20} className="mx-auto mb-1 opacity-80" />
                            <span className="text-xs">é™é›ª {itineraryData[activeDay].weather.snow}</span>
                        </div>
                        <div className="w-[1px] bg-white/20"></div>
                        <div className="text-center">
                            <Thermometer size={20} className="mx-auto mb-1 opacity-80" />
                            <span className="text-xs">{itineraryData[activeDay].weather.range}</span>
                        </div>
                     </div>
                 </div>

                 <div className="bg-[#FFC0CB] text-[#395B64] p-6 rounded-[32px] flex items-start space-x-4 shadow-md">
                    <div className="bg-white/50 p-3 rounded-full">
                        <Utensils size={24} />
                    </div>
                    <div>
                        <h3 className="font-bold text-lg">ç©¿æ­å»ºè­°</h3>
                        <p className="text-sm font-medium mt-1 leading-relaxed opacity-90">
                            {itineraryData[activeDay].weather.wear}
                        </p>
                    </div>
                 </div>

                 {/* Forecast List */}
                 <div className="space-y-2">
                    <h3 className="font-black text-[#395B64] ml-2">æœ¬é€±é å ±</h3>
                    {itineraryData.map((d, i) => (
                        <div key={i} className={`p-4 rounded-2xl flex justify-between items-center transition-all ${i === activeDay ? 'bg-white shadow-md border-l-4 border-[#395B64]' : 'bg-white/40'}`}>
                            <span className="font-bold text-sm w-12 text-slate-500">Day {d.day}</span>
                            <span className="font-bold text-[#395B64]">{d.weather.temp}</span>
                            <span className="text-xs text-slate-400">{d.weather.desc}</span>
                        </div>
                    ))}
                 </div>
             </div>
        )}

      </main>

      {/* --- Floating Bottom Nav --- */}
      <nav className="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] max-w-md bg-white/90 backdrop-blur-xl border border-white/50 p-2 rounded-[35px] shadow-2xl z-50 flex justify-between items-center px-4">
        {[
          { id: 'itinerary', icon: Calendar },
          { id: 'map', icon: MapPin },
          { id: 'budget', icon: Wallet },
          { id: 'weather', icon: Sun },
          { id: 'translate', icon: Languages }
        ].map((item) => (
          <button
            key={item.id}
            onClick={() => setActiveTab(item.id)}
            className={`p-3 rounded-full transition-all duration-300 relative ${
              activeTab === item.id 
              ? 'bg-[#395B64] text-white -translate-y-2 shadow-lg scale-110' 
              : 'text-slate-400 hover:text-[#395B64]'
            }`}
          >
            <item.icon size={20} strokeWidth={activeTab === item.id ? 3 : 2} />
            {activeTab === item.id && (
                <span className="absolute -bottom-6 left-1/2 -translate-x-1/2 text-[9px] font-bold text-[#395B64] whitespace-nowrap">
                    {item.id === 'itinerary' ? 'è¡Œç¨‹' : 
                     item.id === 'map' ? 'åœ°åœ–' :
                     item.id === 'budget' ? 'è¨˜å¸³' :
                     item.id === 'weather' ? 'å¤©æ°£' : 'ç¿»è­¯'}
                </span>
            )}
          </button>
        ))}
      </nav>

      {/* Styles */}
      <style dangerouslySetInnerHTML={{ __html: `
        @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&display=swap');
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
      `}} />
    </div>
  );
};

export default App;
